version: 0.2

phases:
  pre_build:
    commands:
      - sam --version

  build:
    commands:
      - sam build
      - sam deploy --stack-name $STACK_NAME --region $REGION \
        --parameter-overrides \
        ApiDomainName=$API_DOMAIN_NAME \
        SiteDomainName=$SITE_DOMAIN_NAME \
        AuthDomainName=$AUTH_DOMAIN_NAME \
        Certificate=$CERTIFICATE \
        CognitoCertificate=$COGNITO_CERTIFICATE \
        --s3-bucket $SAM_S3_BUCKET \
        --capabilities CAPABILITY_IAM --no-fail-on-empty-changeset --no-progressbar --debug
